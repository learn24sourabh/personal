# Ensure Chocolatey is installed
if (-not (Get-Command choco -ErrorAction SilentlyContinue)) {
    Set-ExecutionPolicy Bypass -Scope Process -Force
    [System.Net.ServicePointManager]::SecurityProtocol = [System.Net.ServicePointManager]::SecurityProtocol -bor 3072
    Invoke-Expression ((New-Object System.Net.WebClient).DownloadString('https://community.chocolatey.org/install.ps1'))
}

# Install Node.js
choco install nodejs -y

# Install jq
choco install jq -y

# Install git
choco install git -y

# Install npm packages globally
npm install -g newman
npm install -g allure-commandline --save-dev

# Add npm global binaries to PATH
$npmGlobalPath = [System.IO.Path]::Combine($env:APPDATA, 'npm')
[Environment]::SetEnvironmentVariable('PATH', $env:PATH + ';' + $npmGlobalPath, [System.EnvironmentVariableTarget]::Machine)

# Verify installations
Write-Output "Node.js version: $(node -v)"
Write-Output "jq version: $(jq --version)"
Write-Output "Git version: $(git --version)"
Write-Output "npm version: $(npm -v)"
Write-Output "Newman version: $(newman -v)"
Write-Output "Allure version: $(allure --version)"

Write-Output "All installations and environment variable settings completed successfully!"